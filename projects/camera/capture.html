<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anonymous Confession Board</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>

<!-- Google Fonts for luxury feel -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
  /* --- Global Styles --- */
  * { box-sizing: border-box; margin:0; padding:0; font-family: 'Roboto', sans-serif; }
  body { background: linear-gradient(145deg,#1a1a1a,#111); color: #eee; display:flex; flex-direction:column; min-height:100vh; }
  h1 { text-align:center; margin:20px 0; font-weight:700; color:#fff; text-shadow: 0 2px 5px rgba(0,0,0,0.5);}
  
  /* --- Chat container --- */
  #chatContainer {
    flex:1;
    overflow-y:auto;
    padding:20px;
    display:flex;
    flex-direction:column;
    gap:15px;
  }

  .message-card {
    background: rgba(30,30,30,0.9);
    border-radius: 15px;
    padding:15px;
    box-shadow: 0 4px 15px rgba(0,0,0,0.5);
    display:flex;
    flex-direction: column;
    transition: transform 0.2s ease, opacity 0.3s ease;
  }

  .message-card img {
    max-width: 100%;
    border-radius: 12px;
    margin-top:10px;
  }

  .message-footer {
    display:flex;
    justify-content:space-between;
    align-items:center;
    margin-top:10px;
    font-size:0.85em;
    color:#ccc;
  }

  .like-btn {
    background: transparent;
    border:none;
    color: #ff5f5f;
    font-weight:bold;
    cursor:pointer;
    display:flex;
    align-items:center;
    gap:5px;
    transition: transform 0.2s;
  }
  .like-btn:hover { transform: scale(1.2); }

  /* --- Input area --- */
  #inputArea {
    display:flex;
    gap:10px;
    padding:15px 20px;
    background: #111;
    border-top:1px solid #333;
    flex-shrink:0;
  }

  #inputArea input[type="text"] {
    flex:1;
    padding:10px 15px;
    border-radius: 12px;
    border:none;
    font-size:1em;
    outline:none;
    background: #222;
    color:#fff;
  }

  #inputArea input[type="file"] {
    display:none;
  }

  #inputArea label {
    background: linear-gradient(135deg,#ff7a18,#af002d);
    padding:10px 15px;
    border-radius:12px;
    cursor:pointer;
    color:#fff;
    font-weight:bold;
    transition: transform 0.2s;
  }
  #inputArea label:hover { transform: scale(1.05); }

  #sendBtn {
    background: linear-gradient(135deg,#18ff7a,#00af2d);
    padding:10px 15px;
    border-radius:12px;
    border:none;
    color:#111;
    font-weight:bold;
    cursor:pointer;
    transition: transform 0.2s;
  }
  #sendBtn:hover { transform: scale(1.05); }

  /* Scrollbar style */
  #chatContainer::-webkit-scrollbar { width:8px; }
  #chatContainer::-webkit-scrollbar-thumb { background: #444; border-radius:4px; }

</style>
</head>
<body>

<h1>üí¨ Anonymous Confession Board</h1>

<div id="chatContainer"></div>

<div id="inputArea">
  <input type="text" id="msgInput" placeholder="Write your confession..." />
  <input type="file" id="imageInput" accept="image/*" />
  <label for="imageInput">üì∑</label>
  <button id="sendBtn">Send</button>
</div>

<script>
  // ----- Firebase Config -----
  const firebaseConfig = {
    apiKey: "AIzaSyCG9ALTmqJPklSBJriWZysOrV0-bYxz84A",
    authDomain: "esrat-4e28f.firebaseapp.com",
    databaseURL: "https://esrat-4e28f-default-rtdb.firebaseio.com",
    projectId: "esrat-4e28f",
    storageBucket: "esrat-4e28f.firebasestorage.app",
    messagingSenderId: "712315598095",
    appId: "1:712315598095:web:2e0c3e91726c1ace312e89"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();
  const storage = firebase.storage();

  const chatContainer = document.getElementById('chatContainer');
  const msgInput = document.getElementById('msgInput');
  const imageInput = document.getElementById('imageInput');
  const sendBtn = document.getElementById('sendBtn');

  // ----- Send message function -----
  sendBtn.addEventListener('click', async () => {
    const text = msgInput.value.trim();
    const file = imageInput.files[0];
    if(!text && !file) return;

    const timestamp = Date.now();
    let filename = null;

    // Upload image if selected
    if(file){
      const ext = file.name.split('.').pop();
      filename = `confessions/${timestamp}.${ext}`;
      const ref = storage.ref(filename);
      await ref.put(file);
    }

    // Push message to DB
    const messageData = {
      text: text || "",
      image: filename || "",
      timestamp: timestamp,
      likes: 0
    };
    db.ref("confessions/" + timestamp).set(messageData);

    msgInput.value = "";
    imageInput.value = null;
  });

  // ----- Listen for new messages -----
  db.ref("confessions").on("child_added", snapshot => {
    const data = snapshot.val();
    const msgCard = document.createElement('div');
    msgCard.className = 'message-card';
    
    // Text
    if(data.text) msgCard.innerHTML += `<div>${data.text}</div>`;
    // Image
    if(data.image){
      const img = document.createElement('img');
      storage.ref(data.image).getDownloadURL().then(url => { img.src = url; });
      msgCard.appendChild(img);
    }

    // Footer (timestamp + like)
    const footer = document.createElement('div');
    footer.className = 'message-footer';
    const time = new Date(data.timestamp).toLocaleString();
    footer.innerHTML = `<span>${time}</span>`;

    // Like button
    const likeBtn = document.createElement('button');
    likeBtn.className = 'like-btn';
    likeBtn.innerHTML = `‚ù§Ô∏è ${data.likes}`;
    likeBtn.addEventListener('click', () => {
      db.ref("confessions/"+data.timestamp+"/likes").transaction(likes => (likes||0)+1);
    });

    footer.appendChild(likeBtn);
    msgCard.appendChild(footer);

    chatContainer.appendChild(msgCard);
    chatContainer.scrollTop = chatContainer.scrollHeight;

    // Animate
    msgCard.style.opacity = 0;
    msgCard.style.transform = "translateY(20px)";
    setTimeout(() => {
      msgCard.style.opacity = 1;
      msgCard.style.transform = "translateY(0)";
    }, 50);
  });

  // ----- Listen for likes update -----
  db.ref("confessions").on("child_changed", snapshot => {
    const data = snapshot.val();
    const cards = chatContainer.children;
    for(let card of cards){
      const footer = card.querySelector('.message-footer');
      if(!footer) continue;
      const likeBtn = footer.querySelector('.like-btn');
      if(!likeBtn) continue;
      if(new Date(data.timestamp).getTime() == data.timestamp){
        likeBtn.innerHTML = `‚ù§Ô∏è ${data.likes}`;
      }
    }
  });

</script>
</body>
</html>
