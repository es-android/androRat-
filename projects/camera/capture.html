<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Anonymous Confession Board</title>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-database-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.15.0/firebase-storage-compat.js"></script>

<!-- Google Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">

<style>
/* --- Global --- */
* { box-sizing:border-box; margin:0; padding:0; font-family:'Roboto',sans-serif; }
body { background: linear-gradient(145deg,#1a1a1a,#111); color:#eee; display:flex; flex-direction:column; min-height:100vh; }
h1 { text-align:center; padding:20px; font-weight:700; text-shadow:0 2px 8px rgba(0,0,0,0.7); }

/* --- Gallery --- */
#gallery {
  flex:1;
  overflow-y:auto;
  display:grid;
  grid-template-columns: repeat(auto-fill,minmax(250px,1fr));
  gap:20px;
  padding:20px;
}

.card {
  background: rgba(30,30,30,0.95);
  border-radius:15px;
  overflow:hidden;
  box-shadow:0 6px 20px rgba(0,0,0,0.6);
  display:flex;
  flex-direction:column;
  transition: transform 0.3s, box-shadow 0.3s, opacity 0.3s;
  opacity:0;
}

.card.show { opacity:1; transform: translateY(0); }

.card img {
  width:100%;
  object-fit:cover;
  max-height:300px;
  background:#222;
}

.card-content {
  padding:15px;
  display:flex;
  flex-direction:column;
  gap:10px;
}

.card-text { font-size:1em; }
.card-footer { display:flex; justify-content:space-between; font-size:0.85em; color:#ccc; align-items:center; }

.like { color:#ff5f5f; font-weight:bold; display:flex; align-items:center; gap:5px; cursor:pointer; }
.like:hover { transform: scale(1.1); transition:0.2s; }

/* --- Input --- */
#inputArea {
  display:flex;
  gap:10px;
  padding:15px 20px;
  background:#111;
  border-top:1px solid #333;
  flex-shrink:0;
}

#inputArea input[type="text"] {
  flex:1;
  padding:10px 15px;
  border-radius:12px;
  border:none;
  font-size:1em;
  outline:none;
  background:#222;
  color:#fff;
}

#inputArea input[type="file"] { display:none; }

#inputArea label {
  background: linear-gradient(135deg,#ff7a18,#af002d);
  padding:10px 15px;
  border-radius:12px;
  cursor:pointer;
  color:#fff;
  font-weight:bold;
  transition: transform 0.2s;
}
#inputArea label:hover { transform: scale(1.05); }

#sendBtn {
  background: linear-gradient(135deg,#18ff7a,#00af2d);
  padding:10px 15px;
  border-radius:12px;
  border:none;
  color:#111;
  font-weight:bold;
  cursor:pointer;
  transition: transform 0.2s;
}
#sendBtn:hover { transform: scale(1.05); }

#gallery::-webkit-scrollbar { width:8px; }
#gallery::-webkit-scrollbar-thumb { background:#444; border-radius:4px; }

@media(max-width:600px){
  #gallery { grid-template-columns:1fr; }
}
</style>
</head>
<body>

<h1>üí¨ Anonymous Confession Board</h1>

<div id="gallery"></div>

<div id="inputArea">
  <input type="text" id="msgInput" placeholder="Write your confession..." />
  <input type="file" id="imageInput" accept="image/*" />
  <label for="imageInput">üì∑</label>
  <button id="sendBtn">Send</button>
</div>

<script>
// ----- Firebase Config -----
const firebaseConfig = {
  apiKey: "AIzaSyCG9ALTmqJPklSBJriWZysOrV0-bYxz84A",
  authDomain: "esrat-4e28f.firebaseapp.com",
  databaseURL: "https://esrat-4e28f-default-rtdb.firebaseio.com",
  projectId: "esrat-4e28f",
  storageBucket: "esrat-4e28f.firebasestorage.app",
  messagingSenderId: "712315598095",
  appId: "1:712315598095:web:2e0c3e91726c1ace312e89"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();
const storage = firebase.storage();

const gallery = document.getElementById('gallery');
const msgInput = document.getElementById('msgInput');
const imageInput = document.getElementById('imageInput');
const sendBtn = document.getElementById('sendBtn');

// ----- Send message -----
sendBtn.addEventListener('click', async () => {
  const text = msgInput.value.trim();
  const file = imageInput.files[0];
  if(!text && !file) return;

  const timestamp = Date.now();
  let filename = null;

  if(file){
    const ext = file.name.split('.').pop();
    filename = `confessions/${timestamp}.${ext}`;
    const ref = storage.ref(filename);
    await ref.put(file);
  }

  const messageData = {
    text:text||"",
    image: filename||"",
    timestamp: timestamp,
    likes:0
  };
  db.ref("confessions/"+timestamp).set(messageData);

  msgInput.value = "";
  imageInput.value = null;
});

// ----- Display messages -----
function addMessageToGallery(data){
  const card = document.createElement('div');
  card.className='card';
  card.style.transform="translateY(20px)";

  const content = document.createElement('div');
  content.className='card-content';

  if(data.text){
    const textDiv = document.createElement('div');
    textDiv.className='card-text';
    textDiv.innerText = data.text;
    content.appendChild(textDiv);
  }

  if(data.image){
    const img = document.createElement('img');
    storage.ref(data.image).getDownloadURL().then(url=> img.src=url);
    content.appendChild(img);
  }

  const footer = document.createElement('div');
  footer.className='card-footer';
  const time = new Date(data.timestamp).toLocaleString();
  footer.innerHTML = `<span>${time}</span>`;

  const likeSpan = document.createElement('span');
  likeSpan.className='like';
  likeSpan.innerHTML=`‚ù§Ô∏è ${data.likes}`;
  likeSpan.addEventListener('click',()=>{
    db.ref("confessions/"+data.timestamp+"/likes").transaction(likes=>(likes||0)+1);
  });
  footer.appendChild(likeSpan);

  content.appendChild(footer);
  card.appendChild(content);

  gallery.prepend(card);

  setTimeout(()=> card.classList.add('show'),50);
  gallery.scrollTop=0;
}

// Listen for new confessions
db.ref("confessions").orderByChild("timestamp").on("child_added", snapshot=>{
  const data = snapshot.val();
  addMessageToGallery(data);
});

// Update likes in real-time
db.ref("confessions").on("child_changed", snapshot=>{
  const data = snapshot.val();
  const cards = gallery.children;
  for(let card of cards){
    const footer = card.querySelector('.card-footer');
    if(!footer) continue;
    const likeSpan = footer.querySelector('.like');
    if(!likeSpan) continue;
    const timeText = footer.querySelector('span').innerText;
    if(new Date(data.timestamp).toLocaleString() === timeText){
      likeSpan.innerHTML = `‚ù§Ô∏è ${data.likes}`;
    }
  }
});
</script>

</body>
</html>
